<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Samplics Documentation - Sample Weight Adjustments</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../pages/weight_replicates.html" rel="next">
<link href="../pages/weight.html" rel="prev">
<link href="../public/img/samplics_logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../public/styles.css">
<meta property="og:title" content="Samplics Documentation - Sample Weight Adjustments">
<meta property="og:description" content="Documentation of the Python package Samplics for statistical design and analysis of complex samples">
<meta property="og:site_name" content="Samplics Documentation">
<meta name="twitter:title" content="Samplics Documentation - Sample Weight Adjustments">
<meta name="twitter:description" content="Documentation of the Python package Samplics for statistical design and analysis of complex samples">
<meta name="twitter:site" content="@MamadouSDiallo">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../public/img/samplics_logo2.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Samplics Documentation</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> 
<span class="menu-text">Overview</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pages/tutorial.html"> 
<span class="menu-text">Tutorial</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/MamadouSDiallo"> <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/samplics-org/samplics"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../pages/tutorial.html">Tutorial</a></li><li class="breadcrumb-item"><a href="../pages/weight.html">Weighting</a></li><li class="breadcrumb-item"><a href="../pages/weight_adj.html">Sample Weight Adjustments</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Overview</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/getting_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Tutorial</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Outline</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datasets</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Size Calculation</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/size.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/size_stagedesign.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sample Size for Stage Design</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Selection</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overviews</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/selection_psus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Selection of PSUs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/selection_ssus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Selection of SSUs</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Weighting</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/weight.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/weight_adj.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Sample Weight Adjustments</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/weight_replicates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Replicate Weights</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Population Parameters Estimation</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/estimation_taylor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Taylor-based Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/estimation_rep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Replicated-based Estimation</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
 <span class="menu-text">Categorical Data Analysis</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/categorical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/categorical_tabulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tabulation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/categorical_ttest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T-test</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">
 <span class="menu-text">Small Area Estimation</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/sae.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/sae_area.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Area Level Modeling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/sae_unit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit Level Modeling</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#design-base-weight" id="toc-design-base-weight" class="nav-link active" data-scroll-target="#design-base-weight">Design (base) weight</a>
  <ul class="collapse">
  <li><a href="#nonresponse-adjustment" id="toc-nonresponse-adjustment" class="nav-link" data-scroll-target="#nonresponse-adjustment">Nonresponse adjustment</a></li>
  <li><a href="#poststratification" id="toc-poststratification" class="nav-link" data-scroll-target="#poststratification">Poststratification</a>
  <ul class="collapse">
  <li><a href="#calibration" id="toc-calibration" class="nav-link" data-scroll-target="#calibration">Calibration</a></li>
  </ul></li>
  <li><a href="#normalization" id="toc-normalization" class="nav-link" data-scroll-target="#normalization">Normalization</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../pages/tutorial.html">Tutorial</a></li><li class="breadcrumb-item"><a href="../pages/weight.html">Weighting</a></li><li class="breadcrumb-item"><a href="../pages/weight_adj.html">Sample Weight Adjustments</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Sample Weight Adjustments</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>The objective of this tutorial is to familiarize ourselves with <em>SampleWeight</em> the <em>samplics</em> class for adjusting sample weights. In practice, it is necessary to adjust base or design sample weights obtained directly from the random sample mechanism. These adjustments are done to correct for nonresponse, reduce effects of extreme/large weights, better align with known auxiliary information, and more. Specifically in this tutorial, we will:</p>
<ul>
<li>learn how to use the method <em>adjust()</em> to redistribute sample weights to account for nonresponse and unknown eligibility,</li>
<li>learn how to use the method <em>poststratify()</em> to ensure that the sample weights sum to known control totals or that the relative distribution of domains is force to known distributions,</li>
<li>learn how to use the method <em>calibrate()</em> to adjust sample weight using auxiliary information under the regression model,</li>
<li>learn how to use the method <em>normalize()</em> to ensure that the sample weights sum to known constants.</li>
</ul>
<p>To run the code in this notebook, we will use the dataset that was developed in the previous tutorial on sample selection.</p>
<div id="24514ba9" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> samplics.datasets <span class="im">import</span> load_psu_sample, load_ssu_sample</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> samplics.weighting <span class="im">import</span> SampleWeight</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="design-base-weight" class="level1">
<h1>Design (base) weight</h1>
<p>The design weight is the inverse of the overall probability of selection which is the product of the first and second probabilities of selection.</p>
<div id="8465a160" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load PSU sample data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>psu_sample_dict <span class="op">=</span> load_psu_sample()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>psu_sample <span class="op">=</span> psu_sample_dict[<span class="st">"data"</span>]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load PSU sample data</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>ssu_sample_dict <span class="op">=</span> load_ssu_sample()</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>ssu_sample <span class="op">=</span> ssu_sample_dict[<span class="st">"data"</span>]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>full_sample <span class="op">=</span> pd.merge(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    psu_sample[[<span class="st">"cluster"</span>, <span class="st">"region"</span>, <span class="st">"psu_prob"</span>]], </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    ssu_sample[[<span class="st">"cluster"</span>, <span class="st">"household"</span>, <span class="st">"ssu_prob"</span>]], </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span><span class="st">"cluster"</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"inclusion_prob"</span>] <span class="op">=</span> full_sample[<span class="st">"psu_prob"</span>] <span class="op">*</span> <span class="op">\</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    full_sample[<span class="st">"ssu_prob"</span>]</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"design_weight"</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> full_sample[<span class="st">"inclusion_prob"</span>]</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>full_sample.head(<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cluster</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">psu_prob</th>
<th data-quarto-table-cell-role="th">household</th>
<th data-quarto-table-cell-role="th">ssu_prob</th>
<th data-quarto-table-cell-role="th">inclusion_prob</th>
<th data-quarto-table-cell-role="th">design_weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7</td>
<td>North</td>
<td>0.187726</td>
<td>72</td>
<td>0.115385</td>
<td>0.021661</td>
<td>46.166667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>7</td>
<td>North</td>
<td>0.187726</td>
<td>73</td>
<td>0.115385</td>
<td>0.021661</td>
<td>46.166667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7</td>
<td>North</td>
<td>0.187726</td>
<td>75</td>
<td>0.115385</td>
<td>0.021661</td>
<td>46.166667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>North</td>
<td>0.187726</td>
<td>715</td>
<td>0.115385</td>
<td>0.021661</td>
<td>46.166667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7</td>
<td>North</td>
<td>0.187726</td>
<td>722</td>
<td>0.115385</td>
<td>0.021661</td>
<td>46.166667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>7</td>
<td>North</td>
<td>0.187726</td>
<td>724</td>
<td>0.115385</td>
<td>0.021661</td>
<td>46.166667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>7</td>
<td>North</td>
<td>0.187726</td>
<td>755</td>
<td>0.115385</td>
<td>0.021661</td>
<td>46.166667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>7</td>
<td>North</td>
<td>0.187726</td>
<td>761</td>
<td>0.115385</td>
<td>0.021661</td>
<td>46.166667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>7</td>
<td>North</td>
<td>0.187726</td>
<td>764</td>
<td>0.115385</td>
<td>0.021661</td>
<td>46.166667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>7</td>
<td>North</td>
<td>0.187726</td>
<td>782</td>
<td>0.115385</td>
<td>0.021661</td>
<td>46.166667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>7</td>
<td>North</td>
<td>0.187726</td>
<td>795</td>
<td>0.115385</td>
<td>0.021661</td>
<td>46.166667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>7</td>
<td>North</td>
<td>0.187726</td>
<td>7111</td>
<td>0.115385</td>
<td>0.021661</td>
<td>46.166667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>7</td>
<td>North</td>
<td>0.187726</td>
<td>7112</td>
<td>0.115385</td>
<td>0.021661</td>
<td>46.166667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>7</td>
<td>North</td>
<td>0.187726</td>
<td>7117</td>
<td>0.115385</td>
<td>0.021661</td>
<td>46.166667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>7</td>
<td>North</td>
<td>0.187726</td>
<td>7123</td>
<td>0.115385</td>
<td>0.021661</td>
<td>46.166667</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>For the purposes of this illustration of handling non-response, we first need to incorporate some household non-response into our example. That is, we simulate the non-response status and store it in the variable <em>response_status</em>. The variable <em>response_status</em> has four possible values: <em>ineligible</em> which indicates that the sampling unit is not eligible for the survey, <em>respondent</em> which indicates that the sampling unit responded to the survey, <em>non-respondent</em> which indicates that the sampling unit did not respond to the survey, and <em>unknown</em> means that we are not able to infer the status of the sampling unit i.e.&nbsp;we do not know whether the sampling unit is eligible or not to the survey.</p>
<div id="2079d51a" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">7</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"response_status"</span>] <span class="op">=</span> np.random.choice(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"ineligible"</span>, <span class="st">"respondent"</span>, <span class="st">"non-respondent"</span>, <span class="st">"unknown"</span>], </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    size<span class="op">=</span>full_sample.shape[<span class="dv">0</span>], </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    p<span class="op">=</span>(<span class="fl">0.10</span>, <span class="fl">0.70</span>, <span class="fl">0.15</span>, <span class="fl">0.05</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>full_sample[</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"cluster"</span>, <span class="st">"region"</span>, <span class="st">"design_weight"</span>, <span class="st">"response_status"</span>]</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    ].head(<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cluster</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">design_weight</th>
<th data-quarto-table-cell-role="th">response_status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>ineligible</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>respondent</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>respondent</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>respondent</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>unknown</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>respondent</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>respondent</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>ineligible</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>respondent</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>respondent</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>respondent</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>non-respondent</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>respondent</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>ineligible</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>respondent</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="nonresponse-adjustment" class="level2">
<h2 class="anchored" data-anchor-id="nonresponse-adjustment">Nonresponse adjustment</h2>
<p>In general, the sample weights are adjusted to redistribute the sample weights of all eligible units for which there is no sufficient response (unit level nonresponse) to the sampling units that sufficiently responded to the survey. This adjustment is done within adjustment classes or domains. Note that the determination of the response categories (unit response, item response, ineligible, etc.) is outside of the scope of this tutorial.</p>
<p>Also, the weights of the sampling units with unknown eligibility are redistributed to the rest of the sampling units. In general, ineligible sampling units receive weights from the sampling units with unknown eligibility since eligible sampling units can be part of the unknown pool.</p>
<p>The method <em>adjust()</em> has a boolean parameter <em>unknown_to_inelig</em> which controls how the sample weights of the unknown is redistributed. By default, <em>adjust()</em> redistribute the sample weights of the sampling units of the unknown to the ineligibles (<em>unknown_to_inelig=True</em>). If we do not wish to redistribute the sample weights of the unknowns to the ineligibles then we just set the flag to False (<em>unknown_to_inelig=Fasle</em>).</p>
<p>In the snippet of code below, we adjust the weight within clusters that is we use clusters as our adjustment classes. Note that we run the nonresponse adjustment twice, the first time with <em>unknown_to_inelig=True</em> (<em>nr_weight</em>) and the second time with the flag equal to False (<em>nr_weight2</em>). With <em>unknown_to_inelig=True</em>, the ineligible received part of the sample weights from the unknowns. Hence, the sample weights for the respondent is less than when the flag is False. With <em>unknown_to_inelig=Fasle</em>, the ineligible did Not receive any weights from the unknowns. Hence, the sample weights for the ineligible units remain the same before and after adjustment. In a real survey, the statistician may decide on the best non-response strategy based on the available information.</p>
<div id="8718ecd2" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>status_mapping <span class="op">=</span> {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"in"</span>: <span class="st">"ineligible"</span>, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rr"</span>: <span class="st">"respondent"</span>, </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nr"</span>: <span class="st">"non-respondent"</span>, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"uk"</span>: <span class="st">"unknown"</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"nr_weight"</span>] <span class="op">=</span> SampleWeight().adjust(</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    samp_weight<span class="op">=</span>full_sample[<span class="st">"design_weight"</span>],</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    adj_class<span class="op">=</span>full_sample[[<span class="st">"region"</span>, <span class="st">"cluster"</span>]],</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    resp_status<span class="op">=</span>full_sample[<span class="st">"response_status"</span>],</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    resp_dict<span class="op">=</span>status_mapping,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"nr_weight2"</span>] <span class="op">=</span> SampleWeight().adjust(</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    samp_weight<span class="op">=</span>full_sample[<span class="st">"design_weight"</span>],</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    adj_class<span class="op">=</span>full_sample[[<span class="st">"region"</span>, <span class="st">"cluster"</span>]],</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    resp_status<span class="op">=</span>full_sample[<span class="st">"response_status"</span>],</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    resp_dict<span class="op">=</span>status_mapping,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    unknown_to_inelig<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>full_sample[[</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cluster"</span>, </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"region"</span>, </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"design_weight"</span>, </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"response_status"</span>, </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nr_weight"</span>, </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nr_weight2"</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    ]].drop_duplicates().head(<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cluster</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">design_weight</th>
<th data-quarto-table-cell-role="th">response_status</th>
<th data-quarto-table-cell-role="th">nr_weight</th>
<th data-quarto-table-cell-role="th">nr_weight2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>ineligible</td>
<td>49.464286</td>
<td>46.166667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>respondent</td>
<td>54.410714</td>
<td>55.400000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>unknown</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>7</td>
<td>North</td>
<td>46.166667</td>
<td>non-respondent</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>10</td>
<td>North</td>
<td>50.783333</td>
<td>non-respondent</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>10</td>
<td>North</td>
<td>50.783333</td>
<td>respondent</td>
<td>70.733929</td>
<td>71.096667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>10</td>
<td>North</td>
<td>50.783333</td>
<td>ineligible</td>
<td>54.410714</td>
<td>50.783333</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>10</td>
<td>North</td>
<td>50.783333</td>
<td>unknown</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>16</td>
<td>South</td>
<td>62.149123</td>
<td>respondent</td>
<td>66.588346</td>
<td>66.588346</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>16</td>
<td>South</td>
<td>62.149123</td>
<td>non-respondent</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">45</td>
<td>24</td>
<td>South</td>
<td>58.940741</td>
<td>respondent</td>
<td>63.852469</td>
<td>63.852469</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>24</td>
<td>South</td>
<td>58.940741</td>
<td>non-respondent</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">55</td>
<td>24</td>
<td>South</td>
<td>58.940741</td>
<td>ineligible</td>
<td>58.940741</td>
<td>58.940741</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">60</td>
<td>29</td>
<td>South</td>
<td>65.702778</td>
<td>unknown</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">61</td>
<td>29</td>
<td>South</td>
<td>65.702778</td>
<td>respondent</td>
<td>101.081197</td>
<td>102.204321</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The default call of <em>adjust()</em> expects standard codes for response status that is “in”, “rr”, “nr”, and “uk” where “in” means ineligible, “rr” means respondent, “nr” means non-respondent, and “uk” means unknown eligibility.</p>
</div>
</div>
<p>In the call above, if we omit the parameter <em>response_dict</em>, then the run would fail with an assertion error message. The current error message is the following: <strong>The response status must only contains values in (‘in’, ‘rr’, ‘nr’, ‘uk’) or the mapping should be provided using response_dict parameter</strong>. For the call to run without using <em>response_dict</em>, it is necessary that the response status takes only values in the standard codes i.e.&nbsp;(“in”, “rr”, “nr”, “uk”). The variable associated with <em>response_status</em> can contain any code but a mapping is necessary when the response variable is not constructed using the standard codes.</p>
<p>To further illustrate the mapping of response status, let’s assume that we have response_status2 which has the values 100 for ineligible, 200 for non-respondent, 300 for respondent, and 999 for unknown.</p>
<div id="fc02bafa" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>response_status2 <span class="op">=</span> np.repeat(<span class="dv">100</span>, full_sample[<span class="st">"response_status"</span>].shape[<span class="dv">0</span>])</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>response_status2[full_sample[<span class="st">"response_status"</span>] <span class="op">==</span> <span class="st">"non-respondent"</span>] <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>response_status2[full_sample[<span class="st">"response_status"</span>] <span class="op">==</span> <span class="st">"respondent"</span>] <span class="op">=</span> <span class="dv">300</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>response_status2[full_sample[<span class="st">"response_status"</span>] <span class="op">==</span> <span class="st">"unknown"</span>] <span class="op">=</span> <span class="dv">999</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>pd.crosstab(response_status2, full_sample[<span class="st">"response_status"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">response_status</th>
<th data-quarto-table-cell-role="th">ineligible</th>
<th data-quarto-table-cell-role="th">non-respondent</th>
<th data-quarto-table-cell-role="th">respondent</th>
<th data-quarto-table-cell-role="th">unknown</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">row_0</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">100</td>
<td>16</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">200</td>
<td>0</td>
<td>23</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">300</td>
<td>0</td>
<td>0</td>
<td>106</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>To use <em>response_status2</em>, we need to map the values 100, 200, 300 and 999 to “in”, “rr”, “nr”, and “uk”. This mapping is done below using the Python dictionary <em>status_mapping2</em>. Using <em>status_mapping2</em> in the function call <em>adjust()</em> will lead to the same adjustment as in the previous run i.e.&nbsp;<em>nr_weight</em> and <em>nr_weight3</em> contain the same adjusted weights.</p>
<div id="694ec0a3" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>status_mapping2 <span class="op">=</span> {<span class="st">"in"</span>: <span class="dv">100</span>, <span class="st">"nr"</span>: <span class="dv">200</span>, <span class="st">"rr"</span>: <span class="dv">300</span>, <span class="st">"uk"</span>: <span class="dv">999</span>}</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"nr_weight3"</span>] <span class="op">=</span> SampleWeight().adjust(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    samp_weight<span class="op">=</span>full_sample[<span class="st">"design_weight"</span>],</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    adj_class<span class="op">=</span>full_sample[[<span class="st">"region"</span>, <span class="st">"cluster"</span>]],</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    resp_status<span class="op">=</span>response_status2,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    resp_dict<span class="op">=</span>status_mapping2,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>full_sample[</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"cluster"</span>, <span class="st">"region"</span>, <span class="st">"response_status"</span>, <span class="st">"nr_weight"</span>, <span class="st">"nr_weight3"</span>]</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    ].drop_duplicates().head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cluster</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">response_status</th>
<th data-quarto-table-cell-role="th">nr_weight</th>
<th data-quarto-table-cell-role="th">nr_weight3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7</td>
<td>North</td>
<td>ineligible</td>
<td>49.464286</td>
<td>49.464286</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>7</td>
<td>North</td>
<td>respondent</td>
<td>54.410714</td>
<td>54.410714</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7</td>
<td>North</td>
<td>unknown</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>7</td>
<td>North</td>
<td>non-respondent</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>10</td>
<td>North</td>
<td>non-respondent</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>If the response status variable only takes values “in”, “nr”, “rr” and “uk”, then it is not necessary to provide the mapping dictionary to the function i.e.&nbsp;<em>resp_dict</em> can be omitted from the function call <em>adjust()</em>.</p>
<div id="32c03e01" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>response_status3 <span class="op">=</span> np.repeat(<span class="st">"in"</span>, full_sample[<span class="st">"response_status"</span>].shape[<span class="dv">0</span>])</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>response_status3[full_sample[<span class="st">"response_status"</span>] <span class="op">==</span> <span class="st">"non-respondent"</span>] <span class="op">=</span> <span class="st">"nr"</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>response_status3[full_sample[<span class="st">"response_status"</span>] <span class="op">==</span> <span class="st">"respondent"</span>] <span class="op">=</span> <span class="st">"rr"</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>response_status3[full_sample[<span class="st">"response_status"</span>] <span class="op">==</span> <span class="st">"unknown"</span>] <span class="op">=</span> <span class="st">"uk"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"nr_weight4"</span>] <span class="op">=</span> SampleWeight().adjust(</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    samp_weight<span class="op">=</span>full_sample[<span class="st">"design_weight"</span>],</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    adj_class<span class="op">=</span>full_sample[[<span class="st">"region"</span>, <span class="st">"cluster"</span>]],</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    resp_status<span class="op">=</span>response_status3,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>full_sample[</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"cluster"</span>, <span class="st">"region"</span>, <span class="st">"response_status"</span>, <span class="st">"nr_weight"</span>, <span class="st">"nr_weight4"</span>]</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    ].drop_duplicates().head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cluster</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">response_status</th>
<th data-quarto-table-cell-role="th">nr_weight</th>
<th data-quarto-table-cell-role="th">nr_weight4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7</td>
<td>North</td>
<td>ineligible</td>
<td>49.464286</td>
<td>49.464286</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>7</td>
<td>North</td>
<td>respondent</td>
<td>54.410714</td>
<td>54.410714</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7</td>
<td>North</td>
<td>unknown</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>7</td>
<td>North</td>
<td>non-respondent</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>10</td>
<td>North</td>
<td>non-respondent</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="faaea4cc" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Just dropping a couple of variables </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># not needed for the rest of the tutorial</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>full_sample.drop(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"psu_prob"</span>, </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ssu_prob"</span>, </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"inclusion_prob"</span>, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nr_weight2"</span>, </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nr_weight3"</span>, </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nr_weight4"</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        ], </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    inplace<span class="op">=</span><span class="va">True</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="poststratification" class="level2">
<h2 class="anchored" data-anchor-id="poststratification">Poststratification</h2>
<p>Poststratification is useful to compensate for under-representation of the sample or to correct for nonsampling error. The most common poststratification method consists of adjusting the sample weights to ensure that they sum to <strong>known</strong> control values from <strong>reliable</strong> souces by adjustment classes (domains). Poststratification classes can be formed using variables beyond the ones involved in the sampling design. For example, socio-economic variables such as age group, gender, race and education are often used to form poststratification classes/cells.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>poststratifying to totals that are known to be out of date, and thus likely inaccurate and/or unreliable may not improve the estimate. Use this with caution.</p>
</div>
</div>
<p>Let’s assume that we have a reliable external source e.g.&nbsp;a recent census that provides the number of households by region. The external source has the following control data: 3700 households for East, 1500 for North, 2800 for South and 6500 for West.</p>
<p>We use the method <em>poststratify()</em> to ensure that the poststratified sample weights (<em>ps_weight</em>) sum to the know control totals by region. Note that the control totals are provided using the Python dictionary <em>census_households</em>.</p>
<div id="e3927826" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>census_households <span class="op">=</span> {<span class="st">"East"</span>: <span class="dv">3700</span>, <span class="st">"North"</span>: <span class="dv">1500</span>, <span class="st">"South"</span>: <span class="dv">2800</span>, <span class="st">"West"</span>: <span class="dv">6500</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"ps_weight"</span>] <span class="op">=</span> SampleWeight().poststratify(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    samp_weight<span class="op">=</span>full_sample[<span class="st">"nr_weight"</span>], </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    control<span class="op">=</span>census_households, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    domain<span class="op">=</span>full_sample[<span class="st">"region"</span>]</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>full_sample.head(<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cluster</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">household</th>
<th data-quarto-table-cell-role="th">design_weight</th>
<th data-quarto-table-cell-role="th">response_status</th>
<th data-quarto-table-cell-role="th">nr_weight</th>
<th data-quarto-table-cell-role="th">ps_weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7</td>
<td>North</td>
<td>72</td>
<td>46.166667</td>
<td>ineligible</td>
<td>49.464286</td>
<td>51.020408</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>7</td>
<td>North</td>
<td>73</td>
<td>46.166667</td>
<td>respondent</td>
<td>54.410714</td>
<td>56.122449</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7</td>
<td>North</td>
<td>75</td>
<td>46.166667</td>
<td>respondent</td>
<td>54.410714</td>
<td>56.122449</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>North</td>
<td>715</td>
<td>46.166667</td>
<td>respondent</td>
<td>54.410714</td>
<td>56.122449</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7</td>
<td>North</td>
<td>722</td>
<td>46.166667</td>
<td>unknown</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>7</td>
<td>North</td>
<td>724</td>
<td>46.166667</td>
<td>respondent</td>
<td>54.410714</td>
<td>56.122449</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>7</td>
<td>North</td>
<td>755</td>
<td>46.166667</td>
<td>respondent</td>
<td>54.410714</td>
<td>56.122449</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>7</td>
<td>North</td>
<td>761</td>
<td>46.166667</td>
<td>ineligible</td>
<td>49.464286</td>
<td>51.020408</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>7</td>
<td>North</td>
<td>764</td>
<td>46.166667</td>
<td>respondent</td>
<td>54.410714</td>
<td>56.122449</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>7</td>
<td>North</td>
<td>782</td>
<td>46.166667</td>
<td>respondent</td>
<td>54.410714</td>
<td>56.122449</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>7</td>
<td>North</td>
<td>795</td>
<td>46.166667</td>
<td>respondent</td>
<td>54.410714</td>
<td>56.122449</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>7</td>
<td>North</td>
<td>7111</td>
<td>46.166667</td>
<td>non-respondent</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>7</td>
<td>North</td>
<td>7112</td>
<td>46.166667</td>
<td>respondent</td>
<td>54.410714</td>
<td>56.122449</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>7</td>
<td>North</td>
<td>7117</td>
<td>46.166667</td>
<td>ineligible</td>
<td>49.464286</td>
<td>51.020408</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>7</td>
<td>North</td>
<td>7123</td>
<td>46.166667</td>
<td>respondent</td>
<td>54.410714</td>
<td>56.122449</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The snippet of code below shows that the poststratified sample weights sum to the expected control totals that is 3700 households for East, 1500 for North, 2800 for South and 6500 for West.</p>
<div id="f161b4f9" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>sum_of_weights <span class="op">=</span> full_sample[</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"region"</span>, <span class="st">"nr_weight"</span>, <span class="st">"ps_weight"</span>]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    ].groupby(<span class="st">"region"</span>).<span class="bu">sum</span>()</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>sum_of_weights.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>sum_of_weights.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">nr_weight</th>
<th data-quarto-table-cell-role="th">ps_weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>East</td>
<td>3698.703391</td>
<td>3700.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>North</td>
<td>1454.250000</td>
<td>1500.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>South</td>
<td>2801.889620</td>
<td>2800.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>West</td>
<td>6485.783333</td>
<td>6500.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The crosstable below shows that only one adjustment factor was calculated and applied per adjustment class or region.</p>
<div id="9ddfa32e" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"ps_adj_fct"</span>] <span class="op">=</span> <span class="op">\</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">round</span>(full_sample[<span class="st">"ps_weight"</span>] <span class="op">/</span> full_sample[<span class="st">"nr_weight"</span>], <span class="dv">12</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>pd.crosstab(full_sample[<span class="st">"ps_adj_fct"</span>], full_sample[<span class="st">"region"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">East</th>
<th data-quarto-table-cell-role="th">North</th>
<th data-quarto-table-cell-role="th">South</th>
<th data-quarto-table-cell-role="th">West</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ps_adj_fct</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0.999326</td>
<td>0</td>
<td>0</td>
<td>38</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1.000351</td>
<td>37</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1.002192</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1.031460</td>
<td>0</td>
<td>24</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In some surveys, there is interest in keeping relative distribution of strata to some known distribution. For example, WHO EPI vaccination surveys often postratify sample weights to ensure that relative sizes of strata reflect offcial statistics e.g.&nbsp;census data. In most cases, the strata are based on some administrative divisions.</p>
<p>For example, assume that according to census data that East contains 25% of the households, North contains 10%, South contains 20% and West contains 45%. We can poststratify using the snippet of code below.</p>
<div id="2cba8044" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>known_ratios <span class="op">=</span> {<span class="st">"East"</span>: <span class="fl">0.25</span>, <span class="st">"North"</span>: <span class="fl">0.10</span>, <span class="st">"South"</span>: <span class="fl">0.20</span>, <span class="st">"West"</span>: <span class="fl">0.45</span>}</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"ps_weight2"</span>] <span class="op">=</span> SampleWeight().poststratify(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    samp_weight<span class="op">=</span>full_sample[<span class="st">"nr_weight"</span>], </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    factor<span class="op">=</span>known_ratios, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    domain<span class="op">=</span>full_sample[<span class="st">"region"</span>]</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>full_sample.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cluster</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">household</th>
<th data-quarto-table-cell-role="th">design_weight</th>
<th data-quarto-table-cell-role="th">response_status</th>
<th data-quarto-table-cell-role="th">nr_weight</th>
<th data-quarto-table-cell-role="th">ps_weight</th>
<th data-quarto-table-cell-role="th">ps_adj_fct</th>
<th data-quarto-table-cell-role="th">ps_weight2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7</td>
<td>North</td>
<td>72</td>
<td>46.166667</td>
<td>ineligible</td>
<td>49.464286</td>
<td>51.020408</td>
<td>1.03146</td>
<td>49.117777</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>7</td>
<td>North</td>
<td>73</td>
<td>46.166667</td>
<td>respondent</td>
<td>54.410714</td>
<td>56.122449</td>
<td>1.03146</td>
<td>54.029554</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7</td>
<td>North</td>
<td>75</td>
<td>46.166667</td>
<td>respondent</td>
<td>54.410714</td>
<td>56.122449</td>
<td>1.03146</td>
<td>54.029554</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>North</td>
<td>715</td>
<td>46.166667</td>
<td>respondent</td>
<td>54.410714</td>
<td>56.122449</td>
<td>1.03146</td>
<td>54.029554</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7</td>
<td>North</td>
<td>722</td>
<td>46.166667</td>
<td>unknown</td>
<td>0.000000</td>
<td>0.000000</td>
<td>NaN</td>
<td>0.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="96f7a4eb" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>sum_of_weights2 <span class="op">=</span> full_sample[</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"region"</span>, <span class="st">"nr_weight"</span>, <span class="st">"ps_weight2"</span>]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ].groupby(<span class="st">"region"</span>).<span class="bu">sum</span>()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>sum_of_weights2.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>sum_of_weights2[<span class="st">"ratio"</span>] <span class="op">=</span> <span class="op">\</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    sum_of_weights2[<span class="st">"ps_weight2"</span>] <span class="op">/</span> <span class="bu">sum</span>(sum_of_weights2[<span class="st">"ps_weight2"</span>])</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>sum_of_weights2.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">nr_weight</th>
<th data-quarto-table-cell-role="th">ps_weight2</th>
<th data-quarto-table-cell-role="th">ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>East</td>
<td>3698.703391</td>
<td>3610.156586</td>
<td>0.25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>North</td>
<td>1454.250000</td>
<td>1444.062634</td>
<td>0.10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>South</td>
<td>2801.889620</td>
<td>2888.125269</td>
<td>0.20</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>West</td>
<td>6485.783333</td>
<td>6498.281855</td>
<td>0.45</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="calibration" class="level3">
<h3 class="anchored" data-anchor-id="calibration">Calibration</h3>
<p>Calibration is a more general concept for adjusting sample weights to sum to known constants. In this tutorial, we consider the generalized regression (GREG) class of calibration. Assume that we have <span class="math inline">\(\hat{\mathbf{Y}} = \sum_{i \in s} w_i y_i\)</span> and know population totals <span class="math inline">\(\mathbf{X} = (\mathbf{X}_1, ..., \mathbf{X}_p)^T\)</span> are available. Working under the model <span class="math inline">\(Y_i | \mathbf{x}_i = \mathbf{x}^T_i \mathbf{\beta} + \epsilon_i\)</span>, the GREG estimator of the population total is</p>
<p><span class="math display">\[\hat{\mathbf{Y}}_{GR} = \hat{\mathbf{Y}} + (\mathbf{X} - \hat{\mathbf{X}})^T\hat{\mathbf{B}}\]</span></p>
<p>where <span class="math inline">\(\hat{\mathbf{B}}\)</span> is the weighted least squares estimate of <span class="math inline">\(\mathbf{\beta}\)</span> and <span class="math inline">\(\hat{\mathbf{X}}\)</span> is the survey estimate of <span class="math inline">\(\mathbf{X}\)</span>. The essential of the GREG approach is, under the regression model, to find the adjusted weights <span class="math inline">\(w^{*}_i\)</span> that are the closest to <span class="math inline">\(w_i\)</span>, to minimize <span class="math inline">\(h(z) = \frac{\sum_{i \in s} c_i(w_i - z_i)}{w_i}\)</span>.</p>
<p>Let us simulate three auxiliary variables that is education, poverty and under_five (number of children under five in the household) and assume that we have the following control totals.</p>
<ul>
<li><p>Total number of under five children: 6300 in the East, 4000 in the North, 6500 in the South and 14000 in the West.</p></li>
<li><p>Poverty (Yes: in poverty / No: not in poverty)</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Region &nbsp;</th>
<th style="text-align: center;">Poverty &nbsp;</th>
<th style="text-align: center;">Number of households</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">East</td>
<td style="text-align: center;">No</td>
<td style="text-align: center;">2600</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">Yes</td>
<td style="text-align: center;">1200</td>
</tr>
<tr class="odd">
<td style="text-align: left;">North</td>
<td style="text-align: center;">No</td>
<td style="text-align: center;">1500</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">Yes</td>
<td style="text-align: center;">200</td>
</tr>
<tr class="odd">
<td style="text-align: left;">South</td>
<td style="text-align: center;">No</td>
<td style="text-align: center;">1800</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">Yes</td>
<td style="text-align: center;">1100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">West</td>
<td style="text-align: center;">No</td>
<td style="text-align: center;">4500</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">Yes</td>
<td style="text-align: center;">2200</td>
</tr>
</tbody>
</table></li>
<li><p>Education (Low: less than secondary, Medium: secondary completed, and High: More than secondary)</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Region &nbsp;</th>
<th style="text-align: center;">Education &nbsp;</th>
<th style="text-align: center;">Number of households</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">East</td>
<td style="text-align: center;">Low</td>
<td style="text-align: center;">2000</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">Medium</td>
<td style="text-align: center;">1400</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: center;">High</td>
<td style="text-align: center;">350</td>
</tr>
<tr class="even">
<td style="text-align: left;">North</td>
<td style="text-align: center;">Low</td>
<td style="text-align: center;">550</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: center;">Medium</td>
<td style="text-align: center;">700</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">High</td>
<td style="text-align: center;">250</td>
</tr>
<tr class="odd">
<td style="text-align: left;">South</td>
<td style="text-align: center;">Low</td>
<td style="text-align: center;">1300</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">Medium</td>
<td style="text-align: center;">1200</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: center;">High</td>
<td style="text-align: center;">350</td>
</tr>
<tr class="even">
<td style="text-align: left;">West</td>
<td style="text-align: center;">Low</td>
<td style="text-align: center;">2100</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: center;">Medium</td>
<td style="text-align: center;">4000</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">High</td>
<td style="text-align: center;">500</td>
</tr>
</tbody>
</table></li>
</ul>
<div id="0bc616dd" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">150</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"education"</span>] <span class="op">=</span> np.random.choice(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>), </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    size<span class="op">=</span><span class="dv">150</span>, </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    p<span class="op">=</span>(<span class="fl">0.40</span>, <span class="fl">0.50</span>, <span class="fl">0.10</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"poverty"</span>] <span class="op">=</span> np.random.choice((<span class="dv">0</span>, <span class="dv">1</span>), size<span class="op">=</span><span class="dv">150</span>, p<span class="op">=</span>(<span class="fl">0.70</span>, <span class="fl">0.30</span>))</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"under_five"</span>] <span class="op">=</span> np.random.choice(</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>), </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    size<span class="op">=</span><span class="dv">150</span>, </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    p<span class="op">=</span>(<span class="fl">0.05</span>, <span class="fl">0.35</span>, <span class="fl">0.25</span>, <span class="fl">0.20</span>, <span class="fl">0.10</span>, <span class="fl">0.05</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>full_sample[[</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cluster"</span>, </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"region"</span>, </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"household"</span>, </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nr_weight"</span>, </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"education"</span>, </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"poverty"</span>, </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"under_five"</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    ]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cluster</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">household</th>
<th data-quarto-table-cell-role="th">nr_weight</th>
<th data-quarto-table-cell-role="th">education</th>
<th data-quarto-table-cell-role="th">poverty</th>
<th data-quarto-table-cell-role="th">under_five</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7</td>
<td>North</td>
<td>72</td>
<td>49.464286</td>
<td>High</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>7</td>
<td>North</td>
<td>73</td>
<td>54.410714</td>
<td>Low</td>
<td>0</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7</td>
<td>North</td>
<td>75</td>
<td>54.410714</td>
<td>Medium</td>
<td>0</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>North</td>
<td>715</td>
<td>54.410714</td>
<td>Medium</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7</td>
<td>North</td>
<td>722</td>
<td>0.000000</td>
<td>Medium</td>
<td>0</td>
<td>2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We now will calibrate the nonreponse weight (<em>nr_weight</em>) to ensure that the estimated number of households in poverty is equal to 4,700 and the estimated total number of children under five is 30,8500. The control numbers 4,700 and 30,800 are obtained from the table above.</p>
<p>The class <em>SampleWeight()</em> uses the method <em>calibrate(samp_weight, aux_vars, control, domain, scale, bounded, modified)</em> to adjust the weight using the GREG approach. * The contol values must be stored in a python dictionnary i.e.&nbsp;totals = {“poverty”: 4700, “under_five”: 30800}. In this case, we have two numerical variables poverty with values in {0, 1} and under_five with values in {0, 1, 2, 3, 4, 5}. * <em>aux_vars</em> is the matrix of covariates.</p>
<div id="f1cd6815" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> {<span class="st">"poverty"</span>: <span class="dv">4700</span>, <span class="st">"under_five"</span>: <span class="dv">30800</span>}</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"calib_weight"</span>] <span class="op">=</span> SampleWeight().calibrate(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    full_sample[<span class="st">"nr_weight"</span>], full_sample[[<span class="st">"poverty"</span>, <span class="st">"under_five"</span>]], totals</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>full_sample[[<span class="st">"cluster"</span>, <span class="st">"region"</span>, <span class="st">"household"</span>, <span class="st">"nr_weight"</span>, <span class="st">"calib_weight"</span>]].head(<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cluster</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">household</th>
<th data-quarto-table-cell-role="th">nr_weight</th>
<th data-quarto-table-cell-role="th">calib_weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7</td>
<td>North</td>
<td>72</td>
<td>49.464286</td>
<td>50.432441</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>7</td>
<td>North</td>
<td>73</td>
<td>54.410714</td>
<td>57.233887</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7</td>
<td>North</td>
<td>75</td>
<td>54.410714</td>
<td>56.292829</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>North</td>
<td>715</td>
<td>54.410714</td>
<td>56.416743</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7</td>
<td>North</td>
<td>722</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>7</td>
<td>North</td>
<td>724</td>
<td>54.410714</td>
<td>57.233887</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>7</td>
<td>North</td>
<td>755</td>
<td>54.410714</td>
<td>57.233887</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>7</td>
<td>North</td>
<td>761</td>
<td>49.464286</td>
<td>49.464286</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>7</td>
<td>North</td>
<td>764</td>
<td>54.410714</td>
<td>56.292829</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>7</td>
<td>North</td>
<td>782</td>
<td>54.410714</td>
<td>57.233887</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>7</td>
<td>North</td>
<td>795</td>
<td>54.410714</td>
<td>58.174944</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>7</td>
<td>North</td>
<td>7111</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>7</td>
<td>North</td>
<td>7112</td>
<td>54.410714</td>
<td>59.116002</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>7</td>
<td>North</td>
<td>7117</td>
<td>49.464286</td>
<td>50.319793</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>7</td>
<td>North</td>
<td>7123</td>
<td>54.410714</td>
<td>56.292829</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can confirm that the estimated totals for the auxiliary variables are equal to their control values.</p>
<div id="b89d7617" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>poverty <span class="op">=</span> full_sample[<span class="st">"poverty"</span>]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>under_5 <span class="op">=</span> full_sample[<span class="st">"under_five"</span>]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>nr_weight <span class="op">=</span> full_sample[<span class="st">"nr_weight"</span>]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>calib_weight <span class="op">=</span> full_sample[<span class="st">"calib_weight"</span>]</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"""</span><span class="ch">\n</span><span class="ss">Total estimated number of poor households was </span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="ss">    </span><span class="sc">{</span><span class="bu">sum</span>(poverty<span class="op">*</span>nr_weight)<span class="sc">:.2f}</span><span class="ss"> before adjustment and </span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="ss">    </span><span class="sc">{</span><span class="bu">sum</span>(poverty<span class="op">*</span>calib_weight)<span class="sc">:.2f}</span><span class="ss"> after adjustment.</span><span class="ch">\n</span><span class="ss">"""</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"""Total estimated number of children under 5 was </span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="ss">    </span><span class="sc">{</span><span class="bu">sum</span>(under_5<span class="op">*</span>nr_weight)<span class="sc">:.2f}</span><span class="ss"> before adjustment and </span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="ss">    </span><span class="sc">{</span><span class="bu">sum</span>(under_5<span class="op">*</span>calib_weight)<span class="sc">:.2f}</span><span class="ss"> after adjustment.</span><span class="ch">\n</span><span class="ss">"""</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Total estimated number of poor households was 
    4521.84 before adjustment and 
    4700.00 after adjustment.

Total estimated number of children under 5 was 
    29442.52 before adjustment and 
    30800.00 after adjustment.
</code></pre>
</div>
</div>
<p>If we want to control by domain then we can do so using the parameter <em>domain</em> of <em>calibrate()</em>. First we need to update the python dictionary holding the control values. Now, those values have to be provided for each domain. Note that the dictionary is now a nested dictionary where the higher level keys hold the domain values i.e.&nbsp;East, North, South and West. Then the higher level values of the dictionary are the dictionaries providing mapping for the auxiliary variables and the corresponding control values.</p>
<div id="ef3e635c" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>totals_by_domain <span class="op">=</span> {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"East"</span>: {<span class="st">"poverty"</span>: <span class="dv">1200</span>, <span class="st">"under_five"</span>: <span class="dv">6300</span>},</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"North"</span>: {<span class="st">"poverty"</span>: <span class="dv">200</span>, <span class="st">"under_five"</span>: <span class="dv">4000</span>},</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"South"</span>: {<span class="st">"poverty"</span>: <span class="dv">1100</span>, <span class="st">"under_five"</span>: <span class="dv">6500</span>},</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"West"</span>: {<span class="st">"poverty"</span>: <span class="dv">2200</span>, <span class="st">"under_five"</span>: <span class="dv">14000</span>},</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"calib_weight_d"</span>] <span class="op">=</span> SampleWeight().calibrate(</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    full_sample[<span class="st">"nr_weight"</span>], </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    full_sample[[<span class="st">"poverty"</span>, <span class="st">"under_five"</span>]], </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    totals_by_domain, full_sample[<span class="st">"region"</span>]</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>full_sample[[</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cluster"</span>, </span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"region"</span>, </span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"household"</span>, </span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nr_weight"</span>, </span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"calib_weight"</span>, </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"calib_weight_d"</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    ]].head(<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cluster</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">household</th>
<th data-quarto-table-cell-role="th">nr_weight</th>
<th data-quarto-table-cell-role="th">calib_weight</th>
<th data-quarto-table-cell-role="th">calib_weight_d</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7</td>
<td>North</td>
<td>72</td>
<td>49.464286</td>
<td>50.432441</td>
<td>40.892864</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>7</td>
<td>North</td>
<td>73</td>
<td>54.410714</td>
<td>57.233887</td>
<td>61.852139</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7</td>
<td>North</td>
<td>75</td>
<td>54.410714</td>
<td>56.292829</td>
<td>59.371664</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>North</td>
<td>715</td>
<td>54.410714</td>
<td>56.416743</td>
<td>47.462625</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7</td>
<td>North</td>
<td>722</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>7</td>
<td>North</td>
<td>724</td>
<td>54.410714</td>
<td>57.233887</td>
<td>61.852139</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>7</td>
<td>North</td>
<td>755</td>
<td>54.410714</td>
<td>57.233887</td>
<td>61.852139</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>7</td>
<td>North</td>
<td>761</td>
<td>49.464286</td>
<td>49.464286</td>
<td>49.464286</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>7</td>
<td>North</td>
<td>764</td>
<td>54.410714</td>
<td>56.292829</td>
<td>59.371664</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>7</td>
<td>North</td>
<td>782</td>
<td>54.410714</td>
<td>57.233887</td>
<td>61.852139</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>7</td>
<td>North</td>
<td>795</td>
<td>54.410714</td>
<td>58.174944</td>
<td>64.332614</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>7</td>
<td>North</td>
<td>7111</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>7</td>
<td>North</td>
<td>7112</td>
<td>54.410714</td>
<td>59.116002</td>
<td>66.813089</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>7</td>
<td>North</td>
<td>7117</td>
<td>49.464286</td>
<td>50.319793</td>
<td>51.719263</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>7</td>
<td>North</td>
<td>7123</td>
<td>54.410714</td>
<td>56.292829</td>
<td>59.371664</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Note that the GREG domain estimates above do not have the additive property. That is the GREG domain estimates do not sum to the overal GREG estimate. To illustrate this, let’s assume that we want to estimate the number of households.</p>
<div id="ff6cd4d3" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">The number of households using the overall GREG is: </span><span class="ch">\</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ss">    </span><span class="sc">{</span><span class="bu">sum</span>(full_sample[<span class="st">'calib_weight'</span>])<span class="sc">:.2f}</span><span class="ss"> </span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The number of households using the domain GREG is: </span><span class="ch">\</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="ss">    </span><span class="sc">{</span><span class="bu">sum</span>(full_sample[<span class="st">'calib_weight_d'</span>])<span class="sc">:.2f}</span><span class="ss"> </span><span class="ch">\n</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
The number of households using the overall GREG is:     14960.15 

The number of households using the domain GREG is:     14959.01 
</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If the additive flag is set to <code>True</code>, the sum of the domain estimates will be equal to the GREG overal estimate.</p>
</div>
</div>
<div id="9149092e" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>totals_by_domain <span class="op">=</span> {</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"East"</span>: {<span class="st">"poverty"</span>: <span class="dv">1200</span>, <span class="st">"under_five"</span>: <span class="dv">6300</span>},</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"North"</span>: {<span class="st">"poverty"</span>: <span class="dv">200</span>, <span class="st">"under_five"</span>: <span class="dv">4000</span>},</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"South"</span>: {<span class="st">"poverty"</span>: <span class="dv">1100</span>, <span class="st">"under_five"</span>: <span class="dv">6500</span>},</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"West"</span>: {<span class="st">"poverty"</span>: <span class="dv">2200</span>, <span class="st">"under_five"</span>: <span class="dv">14000</span>},</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>calib_weight3 <span class="op">=</span> SampleWeight().calibrate(</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    full_sample[<span class="st">"nr_weight"</span>],</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    full_sample[[<span class="st">"poverty"</span>, <span class="st">"under_five"</span>]],</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    totals_by_domain,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    full_sample[<span class="st">"region"</span>],</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    additive<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="a091309c" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>under_5 <span class="op">=</span> np.array(full_sample[<span class="st">"under_five"</span>])</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Each column can be used to estimate a domain: </span><span class="ch">\</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(np.transpose(calib_weight3) <span class="op">*</span> under_5, axis<span class="op">=</span><span class="dv">1</span>)<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Each column can be used to estimate a domain: [ 6300.  4000.  6500. 14000.]
</code></pre>
</div>
</div>
<div id="f3f6c8df" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The number of households using the overall GREG is: </span><span class="ch">\</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span><span class="bu">sum</span>(full_sample[<span class="st">'calib_weight'</span>])<span class="sc">:.2f}</span><span class="ss"> </span><span class="ch">\n</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The number of households using the overall GREG is: 14960.15 
</code></pre>
</div>
</div>
<div id="3a404534" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The number of households using the domain GREG is: </span><span class="ch">\</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span><span class="bu">sum</span>(full_sample[<span class="st">'calib_weight_d'</span>])<span class="sc">:.2f}</span><span class="ss"> (additive=False)</span><span class="ch">\n</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The number of households using the domain GREG is: 14959.01 (additive=False)
</code></pre>
</div>
</div>
<div id="26a5d3ad" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The number of households using the domain GREG is: </span><span class="ch">\</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(np.transpose(calib_weight3))<span class="sc">:.2f}</span><span class="ss"> (additive=True) </span><span class="ch">\n</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The number of households using the domain GREG is: 14960.15 (additive=True) 
</code></pre>
</div>
</div>
</section>
</section>
<section id="normalization" class="level2">
<h2 class="anchored" data-anchor-id="normalization">Normalization</h2>
<p>DHS and MICS normalize the final sample weights to sum to the sample size. We can use the class method <em>normalize()</em> to ensure that the sample weight sum to some constant across the sample or by normalization domain e.g.&nbsp;stratum.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><em>normalization</em> is mostly added here for completeness but it is sheldom to see sample weight normalize in large scale household surveys. One major downside of normalized weights is the Note that estimation of totals does not make sense with normalized weights.</p>
</div>
</div>
<div id="d10129be" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"norm_weight"</span>] <span class="op">=</span> <span class="op">\</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    SampleWeight().normalize(samp_weight<span class="op">=</span>full_sample[<span class="st">"nr_weight"</span>])</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>full_sample[[<span class="st">"cluster"</span>, <span class="st">"region"</span>, <span class="st">"nr_weight"</span>, <span class="st">"norm_weight"</span>]].head(<span class="dv">25</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((full_sample.shape[<span class="dv">0</span>], full_sample[<span class="st">"norm_weight"</span>].<span class="bu">sum</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(150, 150.0)</code></pre>
</div>
</div>
<p>When <em>normalize()</em> is called with only the parameter <em>sample_weight</em> then the sample weights are normalize to sum to the length of the sample weight vector.</p>
<div id="716f1374" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"norm_weight2"</span>] <span class="op">=</span> <span class="op">\</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    SampleWeight().normalize(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>        samp_weight<span class="op">=</span>full_sample[<span class="st">"nr_weight"</span>], </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        control<span class="op">=</span><span class="dv">300</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(full_sample[<span class="st">"norm_weight2"</span>].<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>300.0</code></pre>
</div>
</div>
<div id="ba615cbb" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"norm_weight3"</span>] <span class="op">=</span> SampleWeight().normalize(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    samp_weight<span class="op">=</span>full_sample[<span class="st">"nr_weight"</span>], </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    domain<span class="op">=</span>full_sample[<span class="st">"region"</span>]</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>weight_sum <span class="op">=</span> full_sample.groupby([<span class="st">"region"</span>]).<span class="bu">sum</span>()</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>weight_sum.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>weight_sum[[<span class="st">"region"</span>, <span class="st">"nr_weight"</span>, <span class="st">"norm_weight"</span>, <span class="st">"norm_weight3"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">nr_weight</th>
<th data-quarto-table-cell-role="th">norm_weight</th>
<th data-quarto-table-cell-role="th">norm_weight3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>East</td>
<td>3698.703391</td>
<td>38.419768</td>
<td>45.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>North</td>
<td>1454.250000</td>
<td>15.105820</td>
<td>30.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>South</td>
<td>2801.889620</td>
<td>29.104239</td>
<td>45.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>West</td>
<td>6485.783333</td>
<td>67.370173</td>
<td>30.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="54f81ed6" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>norm_level <span class="op">=</span> {<span class="st">"East"</span>: <span class="dv">10</span>, <span class="st">"North"</span>: <span class="dv">20</span>, <span class="st">"South"</span>: <span class="dv">30</span>, <span class="st">"West"</span>: <span class="dv">50</span>}</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>full_sample[<span class="st">"norm_weight4"</span>] <span class="op">=</span> SampleWeight().normalize(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    samp_weight<span class="op">=</span>full_sample[<span class="st">"nr_weight"</span>], </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    control<span class="op">=</span>norm_level, </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    domain<span class="op">=</span>full_sample[<span class="st">"region"</span>]</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>weight_sum <span class="op">=</span> full_sample.groupby([<span class="st">"region"</span>]).<span class="bu">sum</span>()</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>weight_sum.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>weight_sum[[<span class="st">"region"</span>, <span class="st">"nr_weight"</span>, <span class="st">"norm_weight"</span>, <span class="st">"norm_weight3"</span>, <span class="st">"norm_weight4"</span>,]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">nr_weight</th>
<th data-quarto-table-cell-role="th">norm_weight</th>
<th data-quarto-table-cell-role="th">norm_weight3</th>
<th data-quarto-table-cell-role="th">norm_weight4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>East</td>
<td>3698.703391</td>
<td>38.419768</td>
<td>45.0</td>
<td>10.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>North</td>
<td>1454.250000</td>
<td>15.105820</td>
<td>30.0</td>
<td>20.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>South</td>
<td>2801.889620</td>
<td>29.104239</td>
<td>45.0</td>
<td>30.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>West</td>
<td>6485.783333</td>
<td>67.370173</td>
<td>30.0</td>
<td>50.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../pages/weight.html" class="pagination-link" aria-label="Overview">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Overview</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../pages/weight_replicates.html" class="pagination-link" aria-label="Replicate Weights">
        <span class="nav-page-text">Replicate Weights</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 © Copyright 2019-2020, samplics.
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
<p>Samplics for Design and Analysis of Complex Survey Data</p>
</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../index.html">
<p>Back to Home</p>
</a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/MamadouSDiallo">
      <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/samplics-org/samplics">
      <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>